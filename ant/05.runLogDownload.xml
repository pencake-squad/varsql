<?xml version="1.0" encoding="utf-8"?>
<project xmlns:props="antlib:org.apache.ant.props" name="ftpUpload" default="logDownloadBuild" basedir=".">
	
	<!-- 
		프로퍼티 사용하기 위한 설정
		<project 에 이부분도 셋팅해야함. xmlns:props="antlib:org.apache.ant.props" 
	-->
	<typedef uri="antlib:org.apache.ant.props" resource="org/apache/ant/props/antlib.xml" classpath="ant-props-1.0Alpha.jar" />
	
	<!-- 실행 할 ant target -->
	<!-- 참조 라이브러리 셋팅. -->
	<taskdef name="ssh" classname="com.sshtools.ant.Ssh" />
	
	<propertyhelper>
		<props:nested />
	</propertyhelper>
	
	<!-- 배포 할려는 서버의 정보. -->
	<property file="00.aftpInfo.properties" />

	
	<target name="logDownloadBuild">
		<antcall target="logDownload" >
			<param name="paramPrefix" value="runHHH1"/>
		</antcall>
		<antcall target="logDownload" >
			<param name="paramPrefix" value="runHHH2"/>
		</antcall>
		<antcall target="logDownload" >
			<param name="paramPrefix" value="runKKK1"/>
		</antcall>
		<antcall target="logDownload" >
			<param name="paramPrefix" value="runKKK2"/>
		</antcall>
	</target>
	
	<target name="nonexecute">
		<antcall target="build" />
	</target>
	
	<tstamp>
      <format property="download.date" pattern="yyyyMM"/>
      <format property="download.date.day" pattern="MMdd"/>
  	</tstamp>
	
	<echo message="download.date : ${download.date} / ${download.date.day}" />

	
	<echo message="logfile = ${logfile}" />

	<!--property setting -->
	<property name="version" value="1.0" />
	<property file="build.properties" />
	
	<property name="log.download.root.dir" value="C:/01.HKMC/00.logs/${download.date}/${download.date.day}" />
	<property name="log.default.path" value="/SIM/LOG" />
	<!--property setting -->
	
	
	<!-- 로그 다운로드  target -->
	<target name="logDownload">
		<mkdir dir="${log.download.root.dir}"/>
		
		<echo message="------ ftp class upload start ------" />
		
		
		<property name="prefix.ftp.server" value="${paramPrefix}.ftp.server"/>
		<property name="prefix.ftp.userid" value="${paramPrefix}.ftp.userid"/>
		<property name="prefix.ftp.password" value="${paramPrefix}.ftp.password"/>
		
		<property name="ftp.server" value="${${prefix.ftp.server}}" />
		<property name="ftp.userid" value="${${prefix.ftp.userid}}" />
		<property name="ftp.password" value="${${prefix.ftp.password}}" />
		
		<property name="log.download.dir" value="${log.download.root.dir}/${paramPrefix}" />
		
		
		<echo message="download server ip : ${ftp.server}" />
		<echo message="server download log path : ${log.default.path}" />
		<echo message="local down path : ${log.download.root.dir}" />
		
		<ssh host="${ftp.server}" username="${ftp.userid}" password="${ftp.password}" port="22" version="2">
			<sftp action="get" remotedir="${log.default.path}/tdi" depends="true">
				<fileset id="downloadTdiFile" dir="${log.download.dir}/tdi" casesensitive="yes">
					<include name="**/*.log" />
				</fileset>
			</sftp>
			
			<sftp action="get" remotedir="${log.default.path}/was" depends="true">
				<fileset id="downloadWasFile" dir="${log.download.dir}/was" casesensitive="yes">
					<include name="**/*.log" />
				</fileset>
			</sftp>
		</ssh>
		
		<echo message="------ ftp log download end ------" />
	</target>
</project>